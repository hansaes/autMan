<!DOCTYPE html>
<html lang="zh">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta name="keywords" content="autMan,后台,后台管理系统">
    <meta name="description" content="后台管理系统。">
    <title>autMan后台管理系统</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="stylesheet" type="text/css" href="css/materialdesignicons.min.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="js/bootstrap-multitabs/multitabs.min.css">
    <link rel="stylesheet" type="text/css" href="css/style.min.css">
    <!--对话框插件css-->
    <link rel="stylesheet" type="text/css" href="js/jquery-confirm/jquery-confirm.min.css">

    <link rel="stylesheet" href="js/codemirror/6.65.7/codemirror.css">
    <script src="js/codemirror/6.65.7/codemirror.js"></script>

    <!--引用的文件用于支持对应语言的语法高亮。-->
    <script src="js/codemirror/6.65.7/mode/javascript/javascript.js"></script>
    <script src="js/codemirror/6.65.7/mode/python/python.min.js"></script>
    <script src="js/codemirror/6.65.7/mode/shell/shell.min.js"></script>
    <script src="js/codemirror/6.65.7/mode/go/go.min.js"></script>

    <!--引入css文件，用以支持主题-->
    <!-- <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/theme/eclipse.css">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/theme/seti.css">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/theme/dracula.css"> -->

    <!--引入js，绑定Vim-->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/addon/dialog/dialog.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/keymap/vim.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/addon/search/searchcursor.js"></script>

    <!--代码高亮-->
    <script src="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/addon/selection/active-line.js"></script>

    <!--代码提示-->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/addon/hint/show-hint.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/addon/hint/show-hint.js"></script>

    <!--支持代码折叠-->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/addon/fold/foldgutter.css" />
    <script src="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/addon/fold/foldcode.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/addon/fold/foldgutter.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/addon/fold/brace-fold.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/addon/fold/comment-fold.js"></script>

    <!--全屏模式
    <link rel="stylesheet" href="codemirror-5.65.9/addon/display/fullscreen.css">
    <script src="codemirror-5.65.9/addon/display/fullscreen.js"></script>
    -->

    <!--括号匹配-->
    <script src="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/addon/edit/matchbrackets.js"></script>

    <!--自动补全-->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/addon/hint/show-hint.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/addon/hint/show-hint.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/codemirror/6.65.7/addon/hint/anyword-hint.js"></script>
    <style>
        .CodeMirror {
            border: 1px solid #eee;
            height: auto !important;
        }
    </style>
</head>

<body class="lyear-index">
    <div class="lyear-layout-web">
        <div class="lyear-layout-container">
            <!--左侧导航-->
            <aside class="lyear-layout-sidebar">
                <!-- logo -->
                <div id="logo" class="sidebar-header">
                    <div class="input-group p-3">
                        <input type="text" class="form-control" placeholder="搜索">
                    </div>
                </div>

                <div class="lyear-layout-sidebar-info lyear-scroll">
                    <!--目录-->
                    <nav class="sidebar-main">
                        <ul class="nav-drawer">
                            <!--系统管理-->
                            <li class="nav-item nav-item-has-subnav">
                                <a href="javascript:void(0)"><i class="mdi mdi-language-javascript"></i>
                                    <span>ECMAScript5</span></a>
                                <ul class="nav nav-subnav" id="es5">

                                </ul>
                            </li>
                            <li class="nav-item nav-item-has-subnav">
                                <a href="javascript:void(0)"><i class="mdi mdi-language-python"></i>
                                    <span>Python3</span></a>
                                <ul class="nav nav-subnav" id="python">

                                </ul>
                            </li>
                            <li class="nav-item nav-item-has-subnav">
                                <a href="javascript:void(0)"><i class="mdi mdi-nodejs"></i> <span>Nodejs</span></a>
                                <ul class="nav nav-subnav" id="nodejs">

                                </ul>
                            </li>
                            <li class="nav-item nav-item-has-subnav">
                                <a href="javascript:void(0)"><i class="mdi mdi-language-typescript"></i>
                                    <span>TypeScript</span></a>
                                <ul class="nav nav-subnav" id="typescript">

                                </ul>
                            </li>
                            <li class="nav-item nav-item-has-subnav">
                                <a href="javascript:void(0)"><i class="mdi mdi-language-php"></i> <span>PHP</span></a>
                                <ul class="nav nav-subnav" id="php">

                                </ul>
                            </li>
                            <li class="nav-item nav-item-has-subnav">
                                <a href="javascript:void(0)"><i class="mdi mdi-language-go"></i> <span>Golang</span></a>
                                <ul class="nav nav-subnav" id="golang">

                                </ul>
                            </li>
                            <li class="nav-item nav-item-has-subnav">
                                <a href="javascript:void(0)"><i class="mdi mdi-bash"></i> <span>Shell</span></a>
                                <ul class="nav nav-subnav" id="shell">

                                </ul>
                            </li>
                            <!--End 系统管理-->
                        </ul>
                    </nav>
                </div>
            </aside>
            <!--End 左侧导航-->

            <!--头部信息-->
            <header class="lyear-layout-header">

                <nav class="navbar">

                    <div class="navbar-left">
                        <div class="lyear-aside-toggler">
                            <span class="lyear-toggler-bar"></span>
                            <span class="lyear-toggler-bar"></span>
                            <span class="lyear-toggler-bar"></span>
                        </div>
                    </div>
                    <div class="navbar-left d-flex align-items-center">
                        <a name="jsname" id="jsname"></a>
                        <input class="visually-hidden" type="text" id="jslang">
                    </div>

                    <ul class="navbar-right d-flex align-items-center">
                        <!-- <div class="btn-group btn-group-sm me-2" role="group"> -->
                        <a class="btn btn-primary rounded me-1" href="#!" data-bs-toggle="modal"
                            data-bs-target="#myModal"><i class="mdi mdi-plus"></i> 新建</a>
                        <a class="btn btn-success rounded me-1" href="#!" onclick="autSaveJsContent()"><i
                                class="mdi mdi-check"></i> 保存</a>
                        <a class="btn btn-danger rounded me-3" href="#!" onclick="autDelJsContent()"><i
                                class="mdi mdi-window-close"></i> 删除</a>
                        <!-- </div>
                        <div class="btn-group btn-group-sm" role="group"> -->
                        <a class="btn btn-teal rounded me-1" href="#!" onclick="autRunJsContent()"><i
                                class="mdi mdi-play"></i> 测试</a>
                        <a class="btn btn-indigo rounded me-1" href="#!" onclick="autUploadJsContent()"><i
                                class="mdi mdi-cloud-upload-outline"></i> 上传</a>
                        <a class="btn btn-warning rounded me-1" href="#!" onclick="autOffShelfJsContent()"><i
                                class="mdi mdi-cloud-download-outline"></i> 下架</a>
                        <!-- </div> -->
                    </ul>
                </nav>
            </header>
            <!--End 头部信息-->

            <!--页面主要内容-->
            <main class="lyear-layout-content">
                <div class="card">
                    <div><textarea id="code" value="text" style="min-height: 100px;"></textarea>
                    </div>
                </div>
            </main>
            <!--End 页面主要内容-->
        </div>
    </div>

    <!--模态弹出框-插件新建-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title" id="myModalLabel">新建应用</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <form id="modal" class="form-horizontal" action="#!" method="post" onsubmit="return false;">
                        <div class="mb-3 row align-items-center">
                            <label class="col-md-3 control-label" for="title">名称<span class="text-danger">
                                    *</span></label>
                            <div class="col-md-7">
                                <input class="form-control form-control-sm rounded" type="text" name="title"
                                    id="title" />
                            </div>
                        </div>

                        <div class="mb-3 row align-items-center">
                            <label class="col-md-3 control-label" for="language">插件语言<span class="text-danger">
                                    *</span></label>
                            <div class="col-md-7">
                                <select class="form-control form-control-sm rounded" name="language" id="language">
                                    <option value="es5">ECMAScript5</option>
                                    <option value="python">Python3</option>
                                    <option value="nodejs">NodeJS</option>
                                    <option value="typescript">TypeScript</option>
                                    <option value="php">PHP</option>
                                    <option value="golang">Go</option>
                                    <option value="shell">Shell</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3 row align-items-center">
                            <label class="col-md-3 control-label" for="class">分类</label>
                            <div class="col-md-7">
                                <select class="form-control form-control-sm rounded" name="class" id="class">
                                    <option value="">请选择分类</option>
                                    <option value="工具类">工具类</option>
                                    <option value="查询类">查询类</option>
                                    <option value="娱乐类">娱乐类</option>
                                    <option value="餐饮类">餐饮类</option>
                                    <option value="影音类">影音类</option>
                                    <option value="生活类">生活类</option>
                                    <option value="图片类">图片类</option>
                                    <option value="游戏类">游戏类</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3 row align-items-center">
                            <label class="col-md-3 control-label" for="platform">适用平台</label>
                            <div class="col-md-7">
                                <select class="form-control form-control-sm rounded" type="text" name="platform"
                                    id="platform" multiple>
                                    <option value="qq">qq框架</option>
                                    <option value="qb">qq频道</option>
                                    <option value="wx">wx框架</option>
                                    <option value="wx">wxBOT</option>
                                    <option value="tg">tdlib</option>
                                    <option value="tb">tgbot</option>
                                    <option value="wxmp">订阅号</option>
                                    <option value="wxmp">服务号</option>
                                    <option value="web">webchat</option>
                                </select>
                                <small class="text-warning">不选表示全平台适配</small>
                            </div>
                        </div>

                        <div class="mb-3 row align-items-center">
                            <label class="col-md-3 control-label" for="price">定价</label>
                            <div class="col-md-7">
                                <input class="form-control form-control-sm rounded" type="type" name="price" id="price">
                            </div>
                        </div>

                        <div class="mb-3 row align-items-center">
                            <label class="col-md-3 control-label" for="service">售后联系方式<span class="text-danger">
                                    *</span></label>
                            <div class="col-md-7">
                                <input class="form-control form-control-sm rounded" type="type" name="service"
                                    id="service">
                                <small class="text-warning">确保用户能联系到你</small>
                            </div>
                        </div>
                        <hr class="bg-primary">
                        <div class="mb-3 row align-items-center">
                            <label class="col-md-3 control-label" for="disable">是否禁用</label>
                            <div class="col-md-7">
                                <input class="form-check-input" type="checkbox" name="disable" id="disable"
                                    value="true">
                            </div>
                        </div>

                        <div class="mb-3 row align-items-center">
                            <label class="col-md-3 control-label" for="admin">管理员权限</label>
                            <div class="col-md-7">
                                <input class="form-check-input" type="checkbox" name="admin" id="admin" value="true">
                            </div>
                        </div>

                        <div class="mb-3 row align-items-center">
                            <label class="col-md-3 control-label" for="rules">触发规则</label>
                            <div class="col-md-7">
                                <input class="form-control form-control-sm rounded" type="text" name="rules"
                                    id="rules" />
                            </div>
                        </div>
                        <div class="mb-3 row align-items-center">
                            <label class="col-md-3 control-label" for="cron">执行定时</label>
                            <div class="col-md-7">
                                <input class="form-control form-control-sm rounded" type="text" name="cron" id="cron" />
                            </div>
                        </div>
                        <div class="mb-3 row align-items-center">
                            <label class="col-md-3 control-label" for="priority">优先级</label>
                            <div class="col-md-7">
                                <input class="form-control form-control-sm rounded" type="text" name="priority"
                                    id="priority" />
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-bs-dismiss="modal">关闭</button>
                            <button type="button" class="btn btn-primary" onclick="autSubmitModalForm()">点击保存</button>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </div>

    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/popper.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/perfect-scrollbar.min.js"></script>
    <script type="text/javascript" src="js/bootstrap-multitabs/multitabs.min.js"></script>
    <script type="text/javascript" src="js/jquery.cookie.min.js"></script>
    <script type="text/javascript" src="js/index.min.js"></script>
    <!--对话框插件js-->
    <script type="text/javascript" src="js/jquery-confirm/jquery-confirm.min.js"></script>
    <!--hex编码库-->
    <script type="text/javascript" src="js/hexcode.js"></script>
    <script>
        $(document).ready(function () {
            //设置选中的目录项
            var language = ["es5", "python", "nodejs", "typescript", "php", "golang", "shell"]
            for (var i = 0; i < language.length; i++) {
                fillJsMenu(language[i])
            }
            //设置编辑框的框和内容
            setEditorContent("es5", txt)
        })

        //代码编辑框设置
        var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
            //Java高亮显示
            mode: "text/javascript",
            //显示行号
            lineNumbers: true,
            //设置主题
            theme: "default",
            //代码折叠
            lineWrapping: true,
            foldGutter: true,
            gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
            //全屏模式
            //fullScreen: true,
            scrollbarStyle: null,
            styleActiveLine: true,
            //括号匹配
            matchBrackets: true,
            //智能提示 
            extraKeys: {
                "Ctrl-Space": "autocomplete", //ctrl-space唤起智能提示
                "Ctrl-Q": function (cm) { //Ctrl-Q注释
                    cm.toggleComment();
                },
                "Ctrl-Z": "undo", //撤销
                "Ctrl-Y": "redo", //重做
                "Ctrl-F": "find", //查找
                "Ctrl-G": "findNext", //查找下一个
                "Shift-Ctrl-G": "findPrev", //查找上一个
                "Shift-Ctrl-F": "replace", //替换
                "Shift-Ctrl-R": "replaceAll", //全部替换
                "Ctrl-S": function (cm) { //Ctrl-S保存
                    autSaveJsContent()
                },
                "Ctrl-Enter": function (cm) { //Ctrl-Enter运行
                    autUploadJsContent()
                },

            },
            //绑定Vim，启用Vim模式
            //keyMap: "vim",
        });

        //根据不同的编程语言设置编辑框的模式和内容
        function setEditorContent(language, content) {
            switch (language) {
                case "python":
                    editor.setOption("mode", "text/x-python")
                    //将//替换为#
                    content = content.replace(/\/\//g, "#")
                    break;
                case "nodejs":
                    editor.setOption("mode", "text/javascript")
                    break;
                case "typescript":
                    editor.setOption("mode", "text/typescript")
                    break;
                case "es5":
                    editor.setOption("mode", "text/javascript")
                    break;
                case "shell":
                    //将//替换为#
                    editor.setOption("mode", "text/x-sh")
                    content = content.replace(/\/\//g, "#")
                    break;
                case "php":
                    editor.setOption("mode", "text/x-php")
                    break;
                case "golang":
                    editor.setOption("mode", "text/x-go")
                    break;
            }
            editor.setValue(content)
        }

        //填充插件目录,language为语言(字符串)，activeItem为选中的项（字符串）
        function fillJsMenu(language, activeItem) {
            $.get("/js/menu?language=" + language, function (response) {
                console.log(response)
                var obj
                if (response.code == 200 && response.data) {
                    obj = response.data
                } else {
                    obj = []
                }
                html = ""
                for (var i = 0; i < obj.length; i++) {
                    if (obj[i].disable) {
                        disable = `<i class="mdi mdi-close-circle-outline" style="color:red" onclick="toggle(this,'${language}','${obj[i].name}')"></i>`
                    } else {
                        disable = `<i class="mdi mdi-check-circle-outline" style="color:green" onclick="toggle(this,'${language}','${obj[i].name}')"></i>`
                    }

                    html += `<li class="nav-item" id="li_${encodeToHex(obj[i].name)}" title="${obj[i].name}">
                                <a href="javascript:void(0);">
                                    ${disable}
                                    <span onclick="getJsContent('${language}','${obj[i].name}')">${Substr(obj[i].name, 0, 16)}</span>
                                </a>
                            </li>`
                }
                //目录填充
                console.log(html)
                $(`#${language}`).html(html)
                if (activeItem) {//将某项设置为选中状态
                    $(`#li_${encodeToHex(activeItem)}`).addClass('active')
                }
            });
        }

        //某个插件目录的选中状态
        function autSetSelectedMenuItem(name) {
            // 移除其他所有兄弟元素的 active 类
            if (name) {
                $("#li_" + encodeToHex(name)).siblings().removeClass('active');
                // 为当前元素添加 active 类
                $("#li_" + encodeToHex(name)).addClass('active');
            } else {
                //取消所有的选中
                $(".nav-item").removeClass('active')
            }
        }

        //获取js内容
        function getJsContent(language, name) {
            //设置选中的目录项
            autSetSelectedMenuItem(name)
            //alert("点击作用")
            $.get("/js/content?language=" + language + "&name=" + name, function (response) {
                //alert(data)
                $("#jsname").html(name)
                $("#jslang").val(language)
                editor.setValue(response.data)
            });
        }

        //负责插件的启用和禁用
        function toggle(element, language, name) {
            $.get("/js/toggle?language=" + language + "&name=" + name, function (response) {
                console.log(response)
                if (response.code == 200) {
                    if (response.data.disable) {
                        $(element).removeClass('mdi mdi-check-circle-outline')
                        $(element).addClass('mdi mdi-close-circle-outline')
                        $(element).css('color', 'red')
                    } else {
                        $(element).removeClass('mdi mdi-close-circle-outline')
                        $(element).addClass('mdi mdi-check-circle-outline')
                        $(element).css('color', 'green')
                    }
                    //如果当前显示的是该js文件，则刷新
                    if ($("#jsname").html() === name) {
                        editor.setValue(response.data.content)
                    }
                }
            });
        }

        //新建Js文件
        function autSubmitModalForm() {
            //新建脚本的表单
            const formData = $("#modal").serializeArray();
            let results = [];
            let language = ""
            $.each(formData, function (index, element) {
                if (element.name === "title") {
                    $("#jsname").html(element.value);
                } else if (element.name === "language") {
                    $("#jslang").val(element.value);
                    language = element.value
                }
                if (element.value) {
                    results.push(`[${element.name}: ${element.value}]`);
                }
            });
            let content = ""
            for (var i = 0; i < results.length; i++) {
                results[i] = comment[language] + results[i]
            }
            editor.setValue(results.join("\n"))
            $("#myModal").modal("hide")
            //取消选中的行
            autSetSelectedMenuItem()
        }

        //注释行的符号
        comment = {
            python: "#",
            nodejs: "//",
            typescript: "//",
            es5: "//",
            shell: "#",
            golang: "//",
        }

        //这是es5的模板
        txt = `//==========================市场元数据=========================================
//[open_source: true]是否开源
//[version: 1.0.0]版本号
//[class: 图片类]从工具类、查询类、娱乐类、餐饮类、影音类、生活类、图片类、游戏类等中选择，也可自定义
//[platform: qq,qb,wx,tb,tg,web,wxmp]适用的平台 qq/qb/wx/tb/tg/wxmp/web之间选择，中间用英文逗号隔开
//[public: true] 是否发布？值为true或false，不设置则上传aut云时会自动设置为true，false时上传后不显示在市场中，但是搜索能搜索到，方便开发者测试
//[price: 0.01] 上架价格
//[service: 售后联系方式]写上售后联系方式，方便用户联系咨询
//[description: 关于插件的描述] 使用方法尽量写具体
//==========================事件元数据======================================
//[event: 事件] 匹配事件，多个事件时向下依次写多个
//==========================路由微服务======================================
//[router: /path]微服务路由,前面要加上/
//[method: get]微服务方法，可选get/post/put/delete
//==========================功能元数据======================================
//[rule: 规则] 匹配规则，多个规则时向下依次写多个
//[cron: */1 * * * *] cron定时，支持5位域和6位域
//[admin: true] 是否为管理员指令
//[disable: false] 禁用开关，true表示禁用，false表示可用
//[priority: 0] 优先级，数字越大表示优先级越高
//[server: xxx]
//[bypass: true或者false]是否通过旁路并行处理，多用于全拦截的规则如\[rule: ?\]
//[imType:qq,wx] 白名单,只在qq,wx生效
//[imType+:qq,wx] 同上,不写+号默认为白名单模式
//[imType-:qq] 黑名单qq,除了qq生效
//[userId+:id1,id2] 用户id同样支持黑白名单模式
//[groupId+:id1,id2] 群id同样支持黑白名单模式
//==========================配参数据（最下面）===============================
//[param: {"required":true,"key":"bucket.key","bool":true,"placeholder":"xxx","name":"xxx","desc":"xxx"}]
//[param: {"required":false,"key":"bucket.key","bool":false,"placeholder":"xxx","name":"xxx","desc":"xxx"}]
//[param: {"spliter":true}]
//[param: {"required":true,"key":"bucket.key","bool":false,"placeholder":"xxx","name":"xxx","desc":"xxx"}]
sendText("测试")`

        //真正的保存过程
        function saveJs(language, name) {
            content = editor.getValue()
            if (!content) {
                $.alert("插件内容为空")
                return
            } else {
                //alert("保存文件")
                jsname = encodeURIComponent(name)
                //alert(name)
                content = encodeURIComponent(content)
                //alert(content)
                $.post(`/js/content?language=${language}&name=${jsname}&content=${content}`, function (response) {
                    //alert(data)
                    if (response.code == 200) {
                        //刷新目录
                        fillJsMenu(language, name)
                        //设置选中的目录项
                        $.alert("保存成功")
                    } else {
                        $.alert("保存失败")
                    }
                });
            }
        }

        //保存js文件
        function autSaveJsContent() {
            jslang = $("#jslang").val()
            //文件名
            jsname = $("#jsname").html()
            //控制台方便调试
            console.log("保存文件" + jslang + " " + jsname)
            if (!jsname || !jslang) {//如果没有文件名
                $.confirm({
                    title: '提示',
                    content: '' +
                        '<form action="" class="formName">' +
                        '<div class="mb-3 row align-items-center">' +
                        '<label>请输入插件名</label>' +
                        '<input class="name form-control form-control-sm rounded" type="text" placeholder=""  required />' +
                        `<select class="lang form-control form-control-sm rounded" name="language" id="language">
                            <option value="es5">ECMAScript5</option>
                            <option value="python">Python3</option>
                            <option value="nodejs">NodeJS</option>
                            <option value="typescript">TypeScript</option>
                            <option value="php">PHP</option>
                            <option value="golang">Go</option>
                            <option value="shell">Shell</option>
                        </select>`+
                        '</div>' +
                        '</form>',
                    buttons: {
                        formSubmit: {
                            text: '提交',
                            btnClass: 'btn-blue',
                            action: function () {
                                var name = this.$content.find('.name').val();
                                var lang = this.$content.find('.lang').val();
                                if (!name || !lang) {
                                    $.alert('请您输入插件名和编程语言');
                                    return false;
                                }
                                jsname = name;
                                jslang = lang;
                                $("#jsname").html(jsname)
                                $("#jslang").val(jslang)
                                saveJs(jslang, jsname)
                            }
                        },
                        cancel: {
                            text: '取消'
                        },
                    },
                    onContentReady: function () {
                        var jc = this;
                        this.$content.find('form').on('submit', function (e) {
                            e.preventDefault();
                            jc.$$formSubmit.trigger('click');
                        });
                    }
                });
            } else {
                saveJs(jslang, jsname)
            }
        }

        //删除js文件
        function autDelJsContent() {
            //文件名
            name = $("#jsname").html()
            //获取当前选中的语言
            lang = $("#jslang").val()

            if (name) {
                $.alert({
                    title: '提示框',
                    content: '确定删除？',
                    buttons: {
                        confirm: {
                            text: '确认',
                            btnClass: 'btn-primary',
                            action: function () {
                                $.ajax({
                                    url: '/js/content?language=' + lang + '&name=' + encodeURIComponent(name),
                                    type: 'DELETE',
                                    success: function (response) {
                                        if (response.code == 200) {
                                            $.alert("删除成功")
                                            fillJsMenu(lang)
                                        } else {
                                            $.alert("删除失败:" + response.message)
                                        }
                                    }
                                })
                            }
                        },
                        cancel: {
                            text: '取消',
                            action: function () {
                                //$.alert('你点击了取消!');
                            }
                        }
                    }
                });
            } else {
                $.alert("请在插件目录点选要删除的插件")
            }
        }

        //上传js文件到aut云
        function autUploadJsContent() {
            $.confirm({
                title: '确认上传',
                content: '确认上传到aut云吗？',
                icon: 'mdi mdi-comment-question',
                animation: 'scale',
                closeAnimation: 'scale',
                opacity: 0.5,
                buttons: {
                    'confirm': {
                        text: '继续',
                        btnClass: 'btn-blue',
                        action: function () {
                            //编程语言
                            language = $("#jslang").val()
                            //文件名
                            title = $("#jsname").html()
                            //显示
                            console.log("上传文件" + language + " " + title)

                            if (title && language) {
                                content = editor.getValue()
                                if (content) {
                                    //检查content中是否有service头注
                                    if (/\[service:[^\n]+\]/.test(content) || /\*[ ]?@service[ ][^\n]+/.test(content)) {
                                        $.ajax({
                                            url: '/js/upload',
                                            type: 'POST',
                                            data: {
                                                "language": language,
                                                "title": encodeURIComponent(title),
                                                "content": content,
                                            },
                                            success: function (response) {
                                                if (response.code == 200) {
                                                    $.alert("上传成功，如果你不是aut云的白名单作者，请务必给群主（qq:282617666）留个言或向群主申请加入白名单，因为有不少用户误上传导致垃圾文件较多，群主审核不及时")
                                                } else {
                                                    $.alert("上传失败：" + response.message)
                                                }
                                            }
                                        })
                                    } else {
                                        $.alert("请在头注中添加service售后联系方式")
                                        return
                                    }
                                } else {
                                    $.alert("插件内容不能为空")
                                }
                            } else {
                                $.alert("未选择上传插件")
                            }
                        }
                    },
                    'cancel': {
                        text: '取消',
                        btnClass: 'btn-red',
                        action: function () {

                        }
                    },
                }
            });
        }

        //下架aut云的插件
        function autOffShelfJsContent() {
            language = $("#jslang").val()
            //文件名
            title = $("#jsname").html()
            //显示
            console.log("下架文件" + language + " " + title)
            if (title && language) {
                $.alert("请将插件的头注public设置为false，然后保存，再点击上传按钮即可下架，下架的插件在市场上不可见，但仍可在云市场上搜索到，方便开发者安装调试")
            } else {
                $.alert("未选择下架插件")
            }
        }

        //获取js插件的标注头
        function getJsHeader(cnt) {
            //alert(cnt)
            var maxLine = 0
            var rlt = new Array()
            var lines = cnt.split("\n")
            var reg = /^\/\/[^\S\n\r\t]?\[.+\]/;
            for (var i = 0; i < lines.length; i++) {
                if (reg.test(lines[i])) {
                    maxLine = i
                    rlt.push(lines[i])
                } else {
                    break
                }
            }
            return rlt.join("\n")
        }

        function Substr(str, start, n) { // eslint-disable-line
            if (str.replace(/[u4e00-u9fa5]/g, '**').length <= n) {
                return str;
            }
            let len = 0;
            let tmpStr = '';
            for (let i = start; i < str.length; i++) { // 遍历字符串
                if (/[u4e00-u9fa5]/.test(str[i])) { // 中文 长度为两字节
                    len += 1;
                } else {
                    len += 2;
                }
                if (len > n) {
                    break;
                } else {
                    tmpStr += str[i];
                }
            }
            return tmpStr + "...";
        }
    </script>
</body>

</html>